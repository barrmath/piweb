{% extends 'base.html' %}

{%block content %}
<h1>Flask</h1>
<a href="https://flask.palletsprojects.com/en/3.0.x/">Flask</a> est un module python pour le web. Il fait office de back-end (un peu comme <a herf="https://www.php.net/manual/fr/intro-whatis.php">PHP</a>).<br>
Il existe d'autres modules pour faire du web , par exemple:<ul>
    <li><a href="https://www.djangoproject.com/">Django</a></li>
    <li><a href="https://fastapi.tiangolo.com/">fastAPI</a></li>
</ul>
Un petit descriptif pour chaque:
<h3>Django</h3>
Django est un framework très complets (Base de données integrée, divers outils d'administrations). Mais si vous n'avez pas bessoin de tout ces services, il risque d'être un peu lourd.<br>
<h3>Flask</h3>
Flask est un framework très modulaire. Pas de gestion de Base de données (possible avec <a href="https://www.sqlalchemy.org/">SQLalchemy</a>) SI vous voulez des options, il faut en général installer un autre module.
Il a une approche opposé a Django qui est clé en main.<br>
Les principaux avantages de Flask sont sa simplicité, et sa legéreté.<br>
Le principal défaut, il faut rechercher un module à chaque option se qui allourdi le framework.<br>
<h3>FastAPI</h3>
Très ressemblant à Flask, il apporte des ajouts qui peuvent interesser les developpeurs. Un articles les comparants se trouve <a href="https://www.pythoniste.fr/python/fastapi/les-differences-entre-les-frameworks-flask-et-fastapi/">ici</a>.<br>
<h2>Installation de l'environnement</h2>
<div class="code">pip install flask</div>
 Il faudras peut être faire d'autre installation par la suite. Mais le simple flask suffit pour commencer.
<h2>Utilisation</h2>
Il y a deux utilisations types. Une premiere où vous créer une application. La deuxieme ou vous créer une fonction qui créer l'application. (create factory).<br>
Les deux méthodes possédent des qualités et des défauts. Globlalement créer un app est plus simple qu'une fonction créatrice.<br>
La version create factory vous permet de créer plusieurs instances de votre application pour faire des tests et d'autres choses. Plus d'information <a href="https://flask.palletsprojects.com/en/3.0.x/patterns/appfactories/">ici</a>.<br> 
<h3>arborescence</h3>
On peut tout mettre dans un seul fichier avec Flask.<br>
Mais disons simplement que c'est rapidement le bordel avec une application un peu trop grosse. Je conseille donc de faire au minimun une arborescence.
Mon application est globalement comme ceci :
<pre>
.
├── README.md                        Un fichier readme qui decris l application et la mise en oeuvre.
├── requirements. txt                Un fichier qui liste les paquets python necessaires
├── run.py                           Le ficher de lancement de l'application
└── web_app                          Le dossier qui contient l'application
    ├── __init__.py                  Le fichier init pour crée un module python
    ├── static                       Le dossier static pour les fichiers statiques (CSS, images, ...)
    ├── templates                    Le dossier templates pour les templates html
    └── views.py                     Le fichier qui vous permets de configurer les routes
</pre>
Commençons par le fichier de lancement.
<h3>run.py</h3>
Le fichier de lancement d'une application flask.
<xmp class="code">
from web_app import create_app


if __name__ == "__main__":
    # après verification, Gunicorn ne passe pas par la et se mets par defaut en debug=false
    app = create_app()
    app.run(debug=True, host="0.0.0.0", port=5000)
</xmp>
On importe du module la fonction créatrice.<br>
if __name__ == "__main__":  permet d'executer les lignes indexer en dessous que si le fichier est executer par python<br>
Ainsi vous pouvez activer le debug mode dans ce fichier run mais si vous utiliser un serveur de production, le mode debug e seras pas actif. Vous pouvez tester on est jamais trop sur.<br>
app = create_app()    On crée un l'objet app.<br>
app.run(debug=True, host="0.0.0.0", port=5000) on lance un serveur de DEVELOPPEMENT sur l'adresse local 0.0.0.0 et sur le port 5000 avec le mode debug.<br>

Ce fichier va servir à 2 choses :<ul>
    <li>Lancer un serveur de DEVELOPPEMENT. (le serveur de flask n'est pas à utiliser en production il faut utiliser un serveur de production)</li>
    <li>Donner des informations aux le serveur de production.</li>
</ul>
<h3>__init__.py</h3>
On va modifier ce fichier pour créer la fonction créatrice<br>
<xmp class="code">
from flask import Flask


def create_app():
    app = Flask(__name__, static_folder="static")

    #app.config.from_object("config")

    # routage des pages web

    with app.app_context():
        import web_app.views

    return app
</xmp>
Vous pouvez ajouter un fichier config.py pour configurer un base de donnée, des clés d'accès à des services ...<br>
Attention, proteger bien vos clés et mots de passe. Pensez variable d'environnement, et utiliser le gitignore si vous avez un fichier avec des secrets.<br>
<h3>views.py</h3>
Il defini les routes utilisées par l'application.
<xmp class="code">
# import bibliothèque flask et création application flask
from flask import render_template, request, current_app, send_from_directory

app = current_app
... ... ... ...

@app.route("/robots.txt")
def static_from_root():
    return send_from_directory(app.static_folder, request.path[1:])

@app.route("/", methods=["GET", "POST"])
@app.route("/index/", methods=["GET", "POST"])
def Accueil():
    return render_template("index.html",liste_categorie=liste_categorie,categorie=liste_categorie[0])
</xmp>
On crée l'application et on définit les routes ici.<br>
Vous avez un premier exemple avec le fichier <a href="https://robots-txt.com/">robots.txt</a>.<br>
Vous en avez un deuxieme avec la page index.<br>
Vous definissez une ou plusieurs route avec @app.route (c'est un décorateur en python)
En dessous vous définissez une fonction qui va retourner la page html.
<h3>template, static et jinja2</h3>
Flask est fourni avec le front-end jinja2. Vous pouvez utilisez un autre front-end comme React ou Angular.<br>
On peux créer des pages html dans le dossier template et faire les routes avec views.<br>
Mais par exemple, jái plein de code qui se repetes dans toutes les pages html.<br>
Vous savez le fameux doctype et autre :

Pour éviter de tout recopier sur chaque page, autant ecrire une base et demander à flask/jinja d'étendre la page html.<br>
exemple de ficher de base :
<div class="code">
    <xmp>
<!DOCTYPE html>
<html lang="fr">
    <head>
    <meta charset="utf-8">
    </xmp>
<pre>&#123;% block content %&#125;&#123;% endblock %&#125;</pre>
    <xmp>
    </head>
</html>
    </xmp>
</div>
Fichier qui utilise la base :
<pre class="code">
    &#123;% extends 'base.html' %&#125;

    &#123;%block content %&#125;
    contenu de la page
    &#123;% endblock %&#125;
</pre>
Et voilà plus besoin de recopier le docktype partout. Vous pouvez bien sur ajouter d'autre block que content comme footer ou autre en fonction de votre projet.<br>
et on peut encore aller plus loin.<br>
Par exemple dans ma page base/html :<br>
<img src="{{ url_for('static', filename='img/flask/topnav.png')}}" alt="trop dur de faire en code"></img><br>
La topbar est créée à partir d'une liste, et d'une categorie envoyé par flask. Rappellez-vous de la fonction
<xmp class="code">return render_template("index.html",liste_categorie=liste_categorie,categorie=liste_categorie[0])</xmp>
Voilà pour une rapide introduction à Flask.
<h2>Pour aller plus loin SQL alchemy, login</h2>
https://www.sqlalchemy.org/
https://flask-login.readthedocs.io/en/latest/
https://flask.palletsprojects.com/en/3.0.x/blueprints/
{% endblock %}